<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Week 8: Chapter 12</title>
        <script type="text/javascript" src="https://d3js.org/d3.v3.js"></script>
		<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>-->
		<style type="text/css">
			#tooltip {
				position: absolute;
				width: 200px;
				height: auto;
				padding: 10px;
				background-color: white;
				-webkit-border-radius: 10px;
				-moz-border-radius: 10px;
				border-radius: 10px;
				-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				pointer-events: none;
			}
		</style>
    </head>
	
	<h2><em>Assignment 2B: </em> Visualizing geodata</h2>
	<p>Click a button to see visualizations of the K-mean results.
	   The default view is for K = 2.
	</p>
	
		<div id="k2">
			<input name="k2btn"
				type="button"
				value="K = 2"
				style="float:left"></input>
		</div>
		<div id="k3">
			<input name="k3btn"
				type="button"
				value="K = 3"
				style="float:left"></input>
		</div>
		<div id="k4">
			<input name="k4btn"
				type="button"
				value="K = 4"
				style="float:left"></input>
		</div>
		<div id="k5">
			<input name="k5btn"
				type="button"
				value="K = 5"
				style="float:left"></input>
		</div>
		<div id="k6">
			<input name="k6btn"
				type="button"
				value="K = 6"
				style="float:left"></input>
		</div>
	
    <body>
        <script type="text/javascript">

			//Reading the datafiles once and for all
			var mean_file_k2 = "k2_means.csv";
			var data_file_k2 = "Data_k2.csv";
			var mean_file_k3 = "k3_means.csv";
			var data_file_k3 = "Data_k3.csv";
			var mean_file_k4 = "k4_means.csv";
			var data_file_k4 = "Data_k4.csv";
			var mean_file_k5 = "k5_means.csv";
			var data_file_k5 = "Data_k5.csv";
			var mean_file_k6 = "k6_means.csv";
			var data_file_k6 = "Data_k6.csv";
			
			//Width and height
			var w = 500;
			var h = 500;
			//Define map projection
			var projection = d3.geo.mercator()
								   .center([-122.433701, 37.767683]) //Center at SF
								   .translate([w / 2, h / 2])
								   .scale([180000]); //We add a significant amount of scaling here because the mercator projection 
								   					 // is a projection of the entire world, then center it on SF and zoom in (scale)
			//Define path generator
			var path = d3.geo.path()
							 .projection(projection);
							 
			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
			//Load in GeoJSON data
			d3.json("sfpddistricts.json", function(json) {
				addDataToMap(json);
			});
				
			function addDataToMap(json){
				//Bind data and create one path per GeoJSON feature
				svg.selectAll("path")
				   .data(json.features)
				   .enter()
				   .append("path")
				   .attr("d", path)
				   .style("fill", "steelblue");			
				   
				// addObsToMap();
				// function addObsToMap() {
				// 	//Add dots for the observations
				// 	d3.csv(data_file_k2, function(data_csv){					
				// 		addObs(data_csv);
				// 		console.log("addobstomap");	
				// 		addMeansToMap();
				// 	});					
				// }																
				
				// function addMeansToMap() {
				// 	//Add circles for the K means
				// 	d3.csv(mean_file_k2, function(mean_csv){			
				// 		addMeans(mean_csv)
				// 		console.log("addmeanstomap")
				// 	});	
				// }

				d3.csv(data_file_k2, function(data_csv){			
					addObs(data_csv)
					console.log("addobstomap")
				});	

				d3.csv(mean_file_k2, function(mean_csv){			
					addMeans(mean_csv)
					console.log("addmeanstomap")
				});	

				function addObs(data_csv){
					console.log("addObs")
		   		     svg.selectAll("dot")
						.data(data_csv)
						.enter()
				        .append("circle")
						.attr("id", "obs")
						.attr("cx", function(d) {
							return projection([d.X_input, d.Y_input])[0];
						})
						.attr("cy", function(d) {
							return projection([d.X_input, d.Y_input])[1];
						})
						.attr("r", "1.0")
						.style("fill", function(d) {
								if(d.Label == 0) {
									return "rgb(0, 0, 200)";
								}
								else if(d.Label == 1) {
									return "rgb(0, 200, 0)";
								}
						})	
				}						
				
				function addMeans(mean_csv) {
					console.log("addMeans")
		 			 svg.selectAll("circle")
						.data(mean_csv)
						.enter()
				  	    .append("circle")
						.attr("id", "mean")
						.attr("cx", function(d) {
							return projection([d.lon, d.lat])[0];
						})
						.attr("cy", function(d) {
							return projection([d.lon, d.lat])[1];
						})
						.attr("r", "8")
						.style("stroke", "black")
						.attr("stroke-width", "1.5")
						.style("fill", function(d) {
								if(d.Label == 0) {
									return "rgb(0, 0, 200)";
								}
								else if(d.Label == 1) {
									return "rgb(0, 200, 0)";
								}
						})						
				}				
			};
			
		//On click, update with new data			
		d3.selectAll("div")
			.on("click", function() {
			var divID = d3.select(this).attr("id");
			
				if (divID == "k2") {
					var mean_file = mean_file_k2;
					var data_file = data_file_k2;
				}
				else if (divID == "k3") {
					var mean_file = mean_file_k3;
					var data_file = data_file_k3;
				}
				else if (divID == "k4") {
					var mean_file = mean_file_k4;
					var data_file = data_file_k4;
				}
				else if (divID == "k5") {
					var mean_file = mean_file_k5;
					var data_file = data_file_k5;
				}
				else if (divID == "k6") {
					var mean_file = mean_file_k6;
					var data_file = data_file_k6;
				};
				
				//Add dots for the observations
				d3.csv(data_file, function(data_csv	){
					addObs(data_csv);
				});		
				//Add circles for the K means
				d3.csv(mean_file, function(mean_csv){
					addMeans(mean_csv);	
				});							
				
				function addMeans(mean_csv){
					var circles = svg.selectAll("circle")	//Select all circles
						.data(mean_csv) 					//Re-bind data to existing circles, return the 'update' selection
				 circles.transition()
						.ease("circle")
						.duration(2000)
						.attr("cx", function(d) {
							return projection([d.lon, d.lat])[0];
						})
						.attr("cy", function(d) {
							return projection([d.lon, d.lat])[1];
						})
						.attr("r", "8")
						.style("stroke", "black")
						.attr("stroke-width", "2.5")
						.style("fill", function(d) {
								if(d.Label == 0) {
									return "rgb(0, 0, 200)";
								}
								else if(d.Label == 1) {
									return "rgb(0, 200, 0)";
								}
								else if(d.Label == 2) {
									return "rgb(200, 0, 0)";
								}
								else if(d.Label == 3) {
									return "rgb(200, 200, 0)";
								}
								else if(d.Label == 4) {
									return "rgb(200, 0, 200)";
								}
								else if(d.Label == 5) {
									return "rgb(0, 200, 200)";
								}
								//return "rgb(0, 0, " + (parseInt(d.Label+150)) + ")";						
						})
						
					//Enter
				//  circles.enter()
				// 		.append("circle")
				// 		.attr("cx", function(d) {
				// 			return projection([d.lon, d.lat])[0];
				// 		})
				// 		.attr("cy", function(d) {
				// 			return projection([d.lon, d.lat])[1];
				// 		})
				// 		.attr("r", "8")
				// 		.style("stroke", "black")
				// 		.attr("stroke-width", "2.5")
				// 		.style("fill", function(d) {
				// 				if(d.Label == 0) {
				// 					return "rgb(0, 0, 200)";
				// 				}
				// 				else if(d.Label == 1) {
				// 					return "rgb(0, 200, 0)";
				// 				}
				// 				else if(d.Label == 2) {
				// 					return "rgb(200, 0, 0)";
				// 				}
				// 				else if(d.Label == 3) {
				// 					return "rgb(200, 200, 0)";
				// 				}
				// 				else if(d.Label == 4) {
				// 					return "rgb(200, 0, 200)";
				// 				}
				// 				else if(d.Label == 5) {
				// 					return "rgb(0, 200, 200)";
				// 				}
				// 				//return "rgb(0, 0, " + (parseInt(d.Label+150)) + ")";
				// 		})
						//.style("opacity", 1)	
						
					//Update visuals

						
					//Exit
					circles.exit()
						.transition()
						.duration(500)
						.remove();
				}		

				function addObs(data_csv){
					var dots = svg.selectAll("dot")	//Select all dots
						.data(data_csv); 				//Re-bind data to existing dots, return the 'update' selection
					// dots.transition()
					// 	.ease("circle")
					// 	.duration(2000)
					// 	.attr("cx", function(d) {
					// 		return projection([d.X_input, d.Y_input])[0];
					// 	})
					// 	.attr("cy", function(d) {
					// 		return projection([d.X_input, d.Y_input])[1];
					// 	})
					// 	.attr("r", "1.5")
					// 	.transition().duration(2000)
					// 	.style("fill", function(d) {
					// 			if(d.Label == 0) {
					// 				return "rgb(0, 0, 200)";
					// 			}
					// 			else if(d.Label == 1) {
					// 				return "rgb(0, 200, 0)";
					// 			}
					// 			else if(d.Label == 2) {
					// 				return "rgb(200, 0, 0)";
					// 			}
					// 			else if(d.Label == 3) {
					// 				return "rgb(200, 200, 0)";
					// 			}
					// 			else if(d.Label == 4) {
					// 				return "rgb(200, 0, 200)";
					// 			}
					// 			else if(d.Label == 5) {
					// 				return "rgb(0, 200, 200)";
					// 			}
					// 			//return "rgb(0, 0, " + (parseInt(d.Label+150)) + ")";
					// 	})	
					//Enter
					dots.enter()						
						.append("circle")
						.attr("cx", function(d) {
							return projection([d.X_input, d.Y_input])[0];
						})
						.attr("cy", function(d) {
							return projection([d.X_input, d.Y_input])[1];
						})
						.attr("r", "1.0")
						//.transition().duration(2000)
						.style("fill", function(d) {
								if(d.Label == 0) {
									return "rgb(0, 0, 200)";
								}
								else if(d.Label == 1) {
									return "rgb(0, 200, 0)";
								}
								else if(d.Label == 2) {
									return "rgb(200, 0, 0)";
								}
								else if(d.Label == 3) {
									return "rgb(200, 200, 0)";
								}
								else if(d.Label == 4) {
									return "rgb(200, 0, 200)";
								}
								else if(d.Label == 5) {
									return "rgb(0, 200, 200)";
								}
								//return "rgb(0, 0, " + (parseInt(d.Label+150)) + ")";
						})

					//Exit
					dots.exit()
						.transition()
						.duration(500)
						.remove()
				}		
				
			});	
			
        </script>
    </body>
</html>