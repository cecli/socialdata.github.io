<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Week 8: Chapter 12</title>
        <script type="text/javascript" src="https://d3js.org/d3.v3.js"></script>
		<style type="text/css">
			#tooltip {
				position: absolute;
				width: 200px;
				height: auto;
				padding: 10px;
				background-color: white;
				-webkit-border-radius: 10px;
				-moz-border-radius: 10px;
				border-radius: 10px;
				-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				pointer-events: none;
			}
			
			circle:hover {
				fill: orange;
			}
		</style>
    </head>
	
	<h2><em>Assignment 2B: </em> Visualizing geodata</h2>
	<div>Write explanatory text here</div>
	
	<button type="button"><p id="K2">View K=2</p></button>
	<button type="button"><p id="K3">View K=3</p></button>
	<button type="button"><p id="K4">View K=4</p></button>
	<button type="button"><p id="K5">View K=5</p></button>
	<button type="button"><p id="K6">View K=6</p></button>
	
    <body>
        <script type="text/javascript">

			var mean_file_k2 = "k2_means.csv";
			var data_file_k2 = "Data_k2.csv";
			var mean_file_k3 = "k3_means.csv";
			var data_file_k3 = "Data_k3.csv";
			var mean_file_k4 = "k4_means.csv";
			var data_file_k4 = "Data_k4.csv";
			var mean_file_k5 = "k5_means.csv";
			var data_file_k5 = "Data_k5.csv";
			var mean_file_k6 = "k6_means.csv";
			var data_file_k6 = "Data_k6.csv";

			function sleep (time) {
				return new Promise((resolve) => setTimeout(resolve, time));
			}
			
			//Width and height
			var w = 500;
			var h = 500;
			//Define map projection
			var projection = d3.geo.mercator()
								   .center([-122.433701, 37.767683]) //Center at SF
								   .translate([w / 2, h / 2])
								   .scale([170000]); //We add a significant amount of scaling here because the mercator projection 
								   					 // is a projection of the entire world, then center it on SF and zoom in (scale)
			//Define path generator
			var path = d3.geo.path()
							 .projection(projection);
							 
			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
			//Load in GeoJSON data
			d3.json("sfpddistricts.json", function(json) {
			//d3.json("sfpddistricts.json", function(json) {
				console.log(json);
				addDataToMap(json);
			});
				
			function addDataToMap(json){
				//Bind data and create one path per GeoJSON feature
				svg.selectAll("path")
				   .data(json.features)
				   .enter()
				   .append("path")
				   .attr("d", path)
				   .style("fill", "steelblue");
				
				//Add dots for the observations
				d3.csv("Data_k2.csv", function(data_csv){
					addObs(data_csv);
				});
				
				//Add circles for the K means
				d3.csv("k2_means.csv", function(mean_csv){
					addMeans(mean_csv)
				});				
				
				function addMeans(mean_csv) {
					 svg.selectAll("circle")
						.data(mean_csv)
						.enter()
						.append("circle")
						.attr("cx", function(d) {
							//console.log(projection([d.lon, d.lat]));
							return projection([d.lon, d.lat])[0];
						})
						.attr("cy", function(d) {
							//console.log(projection([d.lon, d.lat])[1]);
							//console.log([d.lon, d.lat][1]);
							return projection([d.lon, d.lat])[1];
						})
						.attr("r", "8")
						.style("stroke", "black")
						.attr("stroke-width", "1.5")
						.style("fill", function(d) {
								if(d.Label == 0) {
									return "rgb(0, 0, 200)";
								}
								else if(d.Label == 1) {
									return "rgb(0, 200, 0)";
								}
								// else if(d.Label == 2) {
								// 	return "rgb(200, 0, 0)";
								// }
								// else if(d.Label == 3) {
								// 	return "rgb(200, 200, 0)";
								// }
								// else if(d.Label == 4) {
								// 	return "rgb(200, 0, 200)";
								// }
								// return "rgb(0, 0, " + (parseInt(d.Label+150)) + ")";
						})
						//.style("opacity", 1)					
				}
				
				function addObs(data_csv){
					//console.log(dataState);
					svg.selectAll("dot")
						.data(data_csv)
						.enter()
						.append("circle")
						.attr("cx", function(d) {
							return projection([d.X_input, d.Y_input])[0];
						})
						.attr("cy", function(d) {
							//console.log(projection([d.X_input, d.Y_input])[1]);
							//console.log([d.X_input, d.Y_input][1]);
							return projection([d.X_input, d.Y_input])[1];
						})
						.attr("r", "1.5")
						.style("fill", function(d) {
								if(d.Label == 0) {
									return "rgb(0, 0, 200)";
								}
								else if(d.Label == 1) {
									return "rgb(0, 200, 0)";
								}
						})	
				}
				
			};
			
		//On click, update with new data			
		d3.selectAll("p")
			.on("click", function() {
			var paragraphID = d3.select(this).attr("id");
			
				// if (paragraphID == "K2") {
				// 	var mean_file = "k2_means.csv";
				// 	var data_file = "Data_k2.csv"
				// }
				// else if (paragraphID == "K3") {
				// 	var mean_file = "k3_means.csv";
				// 	var data_file = "Data_k3.csv"
				// }
				// else if (paragraphID == "K4") {
				// 	var mean_file = "k4_means.csv";
				// 	var data_file = "Data_k4.csv"
				// }
				// else if (paragraphID == "K5") {
				// 	var mean_file = "k5_means.csv";
				// 	var data_file = "Data_k5.csv"
				// }
				// else if (paragraphID == "K6") {
				// 	var mean_file = "k6_means.csv";
				// 	var data_file = "Data_k6.csv"
				// };
				if (paragraphID == "K2") {
					var mean_file = mean_file_k2;
					var data_file = data_file_k2;
				}
				else if (paragraphID == "K3") {
					var mean_file = mean_file_k3;
					var data_file = data_file_k3;
				}
				else if (paragraphID == "K4") {
					var mean_file = mean_file_k4;
					var data_file = data_file_k4;
				}
				else if (paragraphID == "K5") {
					var mean_file = mean_file_k5;
					var data_file = data_file_k5;
				}
				else if (paragraphID == "K6") {
					var mean_file = mean_file_k6;
					var data_file = data_file_k6;
				};
				
				//Add dots for the observations
				d3.csv(data_file, function(data_csv){
					addObs(data_csv);
				});
				
				//Add circles for the K means
				d3.csv(mean_file, function(mean_csv){
					addMeans(mean_csv);
				});
				
				function addMeans(mean_csv){
					var circles = svg.selectAll("circle")	//Select all circles
						.data(mean_csv); 				//Re-bind data to existing circles, return the 'update' selection
				 circles.transition()
						.ease("circle")
						.duration(2000)
						.attr("cx", function(d) {
							return projection([d.lon, d.lat])[0];
						})
						.attr("cy", function(d) {
							return projection([d.lon, d.lat])[1];
						})
						.attr("r", "8")
						.style("stroke", "black")
						.attr("stroke-width", "2.5")
						.style("fill", function(d) {
								if(d.Label == 0) {
									return "rgb(0, 0, 200)";
								}
								else if(d.Label == 1) {
									return "rgb(0, 200, 0)";
								}
								else if(d.Label == 2) {
									return "rgb(200, 0, 0)";
								}
								else if(d.Label == 3) {
									return "rgb(200, 200, 0)";
								}
								else if(d.Label == 4) {
									return "rgb(200, 0, 200)";
								}
								else if(d.Label == 5) {
									return "rgb(0, 200, 200)";
								}
								//return "rgb(0, 0, " + (parseInt(d.Label+150)) + ")";
						})
					//Enter
				 circles.enter()
						.append("circle")
						.attr("cx", function(d) {
							return projection([d.lon, d.lat])[0];
						})
						.attr("cy", function(d) {
							return projection([d.lon, d.lat])[1];
						})
						.attr("r", "8")
						.style("stroke", "black")
						.attr("stroke-width", "2.5")
						.style("fill", function(d) {
								if(d.Label == 0) {
									return "rgb(0, 0, 200)";
								}
								else if(d.Label == 1) {
									return "rgb(0, 200, 0)";
								}
								else if(d.Label == 2) {
									return "rgb(200, 0, 0)";
								}
								else if(d.Label == 3) {
									return "rgb(200, 200, 0)";
								}
								else if(d.Label == 4) {
									return "rgb(200, 0, 200)";
								}
								else if(d.Label == 5) {
									return "rgb(0, 200, 200)";
								}
								//return "rgb(0, 0, " + (parseInt(d.Label+150)) + ")";
						})
						//.style("opacity", 1)	
						
					//Update visuals

						
					//Exit
					circles.exit()
						.transition()
						.duration(500)
						.remove();
				}		

				function addObs(data_csv){
					var dots = svg.selectAll("dot")	//Select all dots
						.data(data_csv); 				//Re-bind data to existing dots, return the 'update' selection
					dots.transition()
						.ease("circle")
						.duration(2000)
						.attr("cx", function(d) {
							return projection([d.X_input, d.Y_input])[0];
						})
						.attr("cy", function(d) {
							return projection([d.X_input, d.Y_input])[1];
						})
						.attr("r", "1.5")
						.transition().duration(2000)
						.style("fill", function(d) {
								if(d.Label == 0) {
									return "rgb(0, 0, 200)";
								}
								else if(d.Label == 1) {
									return "rgb(0, 200, 0)";
								}
								else if(d.Label == 2) {
									return "rgb(200, 0, 0)";
								}
								else if(d.Label == 3) {
									return "rgb(200, 200, 0)";
								}
								else if(d.Label == 4) {
									return "rgb(200, 0, 200)";
								}
								else if(d.Label == 5) {
									return "rgb(0, 200, 200)";
								}
								//return "rgb(0, 0, " + (parseInt(d.Label+150)) + ")";
						})	
					//Enter
					dots.enter()						
						.append("circle")
						.attr("cx", function(d) {
							return projection([d.X_input, d.Y_input])[0];
						})
						.attr("cy", function(d) {
							return projection([d.X_input, d.Y_input])[1];
						})
						.attr("r", "1.5")
						.transition().duration(2000)
						.style("fill", function(d) {
								if(d.Label == 0) {
									return "rgb(0, 0, 200)";
								}
								else if(d.Label == 1) {
									return "rgb(0, 200, 0)";
								}
								else if(d.Label == 2) {
									return "rgb(200, 0, 0)";
								}
								else if(d.Label == 3) {
									return "rgb(200, 200, 0)";
								}
								else if(d.Label == 4) {
									return "rgb(200, 0, 200)";
								}
								else if(d.Label == 5) {
									return "rgb(0, 200, 200)";
								}
								//return "rgb(0, 0, " + (parseInt(d.Label+150)) + ")";
						})

					//Exit
					dots.exit()
						.transition()
						.duration(500)
						.remove()
				}		
				
			});	
			
        </script>
    </body>
</html>